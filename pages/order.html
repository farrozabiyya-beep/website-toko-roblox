<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesananku - DEV ROBLOX SHOP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <a href="../index.html" title="Kembali ke Beranda">
                        <img src="../assets/images/logo.jpg" alt="Logo" class="logo-img" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                        <span class="logo-text">DEV ROBLOX SHOP</span>
                    </a>
                </div>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <nav class="nav-menu" id="navMenu">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="product.html" class="nav-link">Product</a>
                    <a href="review.html" class="nav-link">Review</a>
                    <a href="contact.html" class="nav-link">Kontak</a>
                    <a href="order.html" class="nav-link order-link desktop-order-link">
                        <i class="fas fa-shopping-cart"></i> Pesananku
                    </a>
                    <a href="order.html" class="nav-link order-link-mobile mobile-order-link">
                        <i class="fas fa-shopping-cart"></i> Pesananku
                    </a>
                </nav>
            </div>
        </nav>
    </header>

    <!-- Flash Sale Banner -->
    <div id="flashSaleBanner" class="flash-sale-banner" style="display: none;">
        <div class="flash-sale-content">
            <i class="fas fa-fire"></i>
            <span class="flash-sale-text">FLASH SALE SEDANG BERLANGSUNG!</span>
            <i class="fas fa-fire"></i>
        </div>
    </div>

    <!-- Main Content -->
    <main class="order-page">
        <div class="container">
            <h1 class="page-title">Cek Pesanan Saya</h1>

            <div class="order-container">
                <!-- Search Section -->
                <div class="search-section">
                    <div class="search-card">
                        <h3><i class="fas fa-search"></i> Cari ID Pesanan</h3>
                        <div class="search-input-group">
                            <input type="text" class="form-control search-input" id="searchOrderId" 
                                   placeholder="Masukkan ID Pesanan (contoh: ORD1234567890)">
                            <button class="btn btn-primary" onclick="searchByOrderId()">
                                <i class="fas fa-search"></i> Cari
                            </button>
                        </div>
                    </div>

                    <div class="search-card">
                        <h3><i class="fas fa-user"></i> Cari Username</h3>
                        <div class="search-input-group">
                            <input type="text" class="form-control search-input" id="searchUsername" 
                                   placeholder="Masukkan Username Roblox Anda">
                            <button class="btn btn-primary" onclick="searchByUsername()">
                                <i class="fas fa-search"></i> Cari
                            </button>
                        </div>
                    </div>

                    <div class="search-card">
                        <h3><i class="fas fa-phone"></i> Cari Nomor Telepon</h3>
                        <div class="search-input-group">
                            <input type="tel" class="form-control search-input" id="searchPhone" 
                                   placeholder="Masukkan Nomor Telepon">
                            <button class="btn btn-primary" onclick="searchByPhone()">
                                <i class="fas fa-search"></i> Cari
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="results-section">
                    <div id="resultsContainer" class="results-container"></div>
                </div>
            </div>
        </div>
    </main>

    <style>
        .order-page {
            min-height: calc(100vh - 200px);
            padding: 60px 20px;
            background: linear-gradient(135deg, rgba(0, 31, 63, 0.02), rgba(0, 71, 171, 0.02));
        }

        .page-title {
            text-align: center;
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 50px;
        }

        .order-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .search-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .search-card {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 31, 63, 0.08);
            border-left: 4px solid var(--secondary-color);
        }

        .search-card h3 {
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-card h3 i {
            color: var(--accent-color);
            font-size: 1.3rem;
        }

        .search-input-group {
            display: flex;
            gap: 10px;
        }

        .search-input-group .form-control {
            flex: 1;
        }

        .search-input-group .btn {
            white-space: nowrap;
            padding: 12px 20px;
        }

        .results-section {
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 31, 63, 0.08);
        }

        .results-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-gray);
            text-align: center;
        }

        .no-results {
            text-align: center;
            padding: 40px;
        }

        .no-results i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .order-result {
            padding: 20px;
            background: linear-gradient(135deg, rgba(0, 71, 171, 0.05), rgba(0, 191, 255, 0.05));
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
        }

        .order-result h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 31, 63, 0.1);
            font-size: 0.95rem;
        }

        .order-result-item:last-child {
            border-bottom: none;
        }

        .order-result-label {
            color: var(--dark-gray);
            font-weight: 500;
        }

        .order-result-value {
            color: var(--primary-color);
            font-weight: 600;
        }

        .order-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .order-status.pending {
            background-color: var(--warning-color);
            color: var(--primary-color);
        }

        .order-status.completed {
            background-color: var(--success-color);
            color: var(--white);
        }

        .order-status.failed {
            background-color: var(--danger-color);
            color: var(--white);
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 1.8rem;
            }

            .search-section {
                grid-template-columns: 1fr;
            }

            .search-input-group {
                flex-direction: column;
            }

            .search-input-group .btn {
                width: 100%;
            }
        }
    </style>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>DEV ROBLOX SHOP</h4>
                    <p>Penyedia kebutuhan Roblox terpercaya dan berkualitas</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="../index.html">Beranda</a></li>
                        <li><a href="product.html">Produk</a></li>
                        <li><a href="review.html">Review</a></li>
                        <li><a href="contact.html">Kontak</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 DEV ROBLOX SHOP. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modal Profile -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Menu Profil</h2>
            <a href="order.html" class="modal-link">
                <i class="fas fa-shopping-cart"></i> Pesanan Saya
            </a>
            <a href="admin/login.html" class="modal-link">
                <i class="fas fa-lock"></i> Admin Panel
            </a>
        </div>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        const resultsContainer = document.getElementById('resultsContainer');

        // ========== LOAD ORDERS FROM LOCALSTORAGE ==========
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            if (orders.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-inbox"></i>
                        <p>Belum ada pesanan ditemukan.</p>
                    </div>
                `;
                return;
            }

            resultsContainer.innerHTML = orders.map((order, index) => `
                <div class="order-result">
                    <h4>
                        <i class="fas fa-box"></i>
                        Pesanan #${order.id}
                    </h4>
                    <div class="order-result-item">
                        <span class="order-result-label">Username:</span>
                        <span class="order-result-value">${order.username || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Item:</span>
                        <span class="order-result-value">${order.item || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Harga:</span>
                        <span class="order-result-value">Rp ${(order.price || 0).toLocaleString('id-ID')}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Metode Pembayaran:</span>
                        <span class="order-result-value">${order.paymentMethod || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">WhatsApp:</span>
                        <span class="order-result-value">${order.whatsapp || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Tanggal:</span>
                        <span class="order-result-value">${order.date || new Date().toLocaleDateString('id-ID')}</span>
                    </div>
                    <span class="order-status ${(order.status || 'pending').toLowerCase()}">
                        ${getStatusBadge(order.status)}
                    </span>
                </div>
            `).join('');
        }

        // ========== GET STATUS BADGE ==========
        function getStatusBadge(status) {
            const statusMap = {
                'pending': 'â³ Menunggu Konfirmasi',
                'Pending': 'â³ Menunggu Konfirmasi',
                'diproses': 'ðŸ”„ Diproses',
                'Diproses': 'ðŸ”„ Diproses',
                'selesai': 'âœ“ Selesai',
                'Selesai': 'âœ“ Selesai',
                'dibatalkan': 'âœ— Dibatalkan',
                'Dibatalkan': 'âœ— Dibatalkan'
            };
            return statusMap[status] || 'â³ Menunggu Konfirmasi';
        }

        // ========== SEARCH BY ORDER ID ==========
        function searchByOrderId() {
            const orderId = document.getElementById('searchOrderId').value.trim();
            if (!orderId) {
                showNotification('Masukkan ID Pesanan', 'error');
                return;
            }

            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders.find(o => o.id && o.id.toString().includes(orderId));
            
            if (order) {
                displayOrderResults([order]);
            } else {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>Pesanan dengan ID <strong>${orderId}</strong> tidak ditemukan</p>
                    </div>
                `;
            }
        }

        // ========== SEARCH BY USERNAME ==========
        function searchByUsername() {
            const username = document.getElementById('searchUsername').value.trim();
            if (!username) {
                showNotification('Masukkan Username', 'error');
                return;
            }

            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const filtered = orders.filter(o => 
                o.username && o.username.toLowerCase().includes(username.toLowerCase())
            );
            
            if (filtered.length > 0) {
                displayOrderResults(filtered);
            } else {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>Tidak ada pesanan untuk username <strong>${username}</strong></p>
                    </div>
                `;
            }
        }

        // ========== SEARCH BY PHONE ==========
        function searchByPhone() {
            const phone = document.getElementById('searchPhone').value.trim();
            if (!phone) {
                showNotification('Masukkan Nomor Telepon', 'error');
                return;
            }

            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const filtered = orders.filter(o => 
                o.whatsapp && o.whatsapp.toString().includes(phone)
            );
            
            if (filtered.length > 0) {
                displayOrderResults(filtered);
            } else {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>Tidak ada pesanan untuk nomor <strong>${phone}</strong></p>
                    </div>
                `;
            }
        }

        // ========== DISPLAY ORDER RESULTS ==========
        function displayOrderResults(orders) {
            resultsContainer.innerHTML = orders.map(order => `
                <div class="order-result">
                    <h4>
                        <i class="fas fa-box"></i>
                        Pesanan #${order.id}
                    </h4>
                    <div class="order-result-item">
                        <span class="order-result-label">Username:</span>
                        <span class="order-result-value">${order.username || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Item:</span>
                        <span class="order-result-value">${order.item || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Harga:</span>
                        <span class="order-result-value">Rp ${(order.price || 0).toLocaleString('id-ID')}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Metode Pembayaran:</span>
                        <span class="order-result-value">${order.paymentMethod || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">WhatsApp:</span>
                        <span class="order-result-value">${order.whatsapp || '-'}</span>
                    </div>
                    <div class="order-result-item">
                        <span class="order-result-label">Tanggal:</span>
                        <span class="order-result-value">${order.date || new Date().toLocaleDateString('id-ID')}</span>
                    </div>
                    <span class="order-status ${(order.status || 'pending').toLowerCase()}">
                        ${getStatusBadge(order.status)}
                    </span>
                </div>
            `).join('');
        }

        // ========== ALLOW SEARCH ON ENTER KEY ==========
        ['searchOrderId', 'searchUsername', 'searchPhone'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (id === 'searchOrderId') searchByOrderId();
                        else if (id === 'searchUsername') searchByUsername();
                        else if (id === 'searchPhone') searchByPhone();
                    }
                });
            }
        });

        // ========== INITIALIZE PAGE ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Clear old order data on first load (prevent confusion with old data)
            if (!localStorage.getItem('_orderPageCleared')) {
                localStorage.removeItem('orders');
                localStorage.setItem('_orderPageCleared', 'true');
            }
            
            // Show initial placeholder - jangan tampilkan data sampai user search
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <p>Cari pesanan Anda menggunakan ID, Username, atau Nomor WhatsApp</p>
                </div>
            `;
        });

        // ========== REAL-TIME SYNC FROM ADMIN PANEL ==========
        window.addEventListener('storage', (e) => {
            if (e.key === 'orders' || e.key === '_adminDataUpdate') {
                // Jangan auto-refresh results, biar user yang control via search
                console.log('ðŸ“Š Order data updated from admin panel');
            }
        });
    </script>
    <script src="../assets/js/website-features.js"></script>
    <script src="../assets/js/page-loader.js"></script>
    <script src="../assets/js/website-sync.js"></script>
    <script src="../assets/js/pages-sync.js"></script>
    <script src="../assets/js/order-page-manager.js"></script>
</body>
</html>

